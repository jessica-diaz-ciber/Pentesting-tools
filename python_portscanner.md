## Intro

Script for scanning ports:

- provide a single port `-p 80` 
- provide a list of ports `-p 21,22,53,80,443` 
- or a range `-p 1-1000`

It gives us som header info too

```bash
$: ./portscan.py -t scanme.org -p 1-1000      

[+] El puerto 22 esta abierto - SSH-2.0-OpenSSH_6.6.1p1 Ubuntu-2ubuntu2.13
SSH-2.0-OpenSSH_6.6.1p1 Ubuntu-2ubuntu2.13

[+] El puerto 80 esta abierto - HTTP/1.1 200 OK
HTTP/1.1 200 OK
Date: Tue, 26 Dec 2023 10:48:03 GMT
Server: Apache/2.4.7 (Ubuntu)
Accept-Ranges: bytes
Vary: Accept-Encoding
Connection: close
Content-Type: text/html
```

--------------------------

## Script

```python
#!/usr/bin/env python3
import socket, argparse, threading, sys, time, signal
from termcolor import colored
from concurrent.futures import ThreadPoolExecutor

open_socks = []
def def_handler(sig, frame):
    print("Saliendo..."); [sock.close() for sock in open_socks]; sys.exit(0)
signal.signal(signal.SIGINT, def_handler)

def get_arguments():
    parser = argparse.ArgumentParser(description='Fast TCP Port Scanner')
    parser.add_argument("-t", "--target", dest="target", help="Victim target to scan (Ex: -t 192.168.1.1)") 
    parser.add_argument("-p", "--port", dest="port", help="Port range to scan (Ex: -p 1-100)")
    options = parser.parse_args() 
    if options.target is None or options.port is None: 
        parser.print_help(); sys.exit(1)     
    return options.target, options.port 
    
def port_scanner(port, host): 
    s = socket.socket(socket.AF_INET, socket.SOCK_STREAM); s.settimeout(1); open_socks.append(s)
    try: 
        s.connect((host, port)); s.sendall(b"HEAD / HTTP/1.0\r\n\r\n") 
        resp = s.recv(1024); resp = resp.decode(errors='ignore').split('\n')
        if resp:
            print(colored(f"\n[+] El puerto {port} esta abierto - {resp[0]}", 'green'))
            [print(colored(f"{line}", 'yellow')) for line in resp]
        else: 
            print(colored(f"\n[+] El puerto {port} esta abierto", 'green')) 
    except Exception:
        pass
    finally: 
        s.close() 

def parse_port(ports_str):
    if '-' in ports_str:
        start, end = map(int, ports_str.split('-'))
        return range(start, end+1)
    elif ',' in ports_str:
        return map(int, ports_str.split(','))
    else: 
        return (int(ports_str),)

target, ports_str = get_arguments(); ports = parse_port(ports_str); start = time.time()
with ThreadPoolExecutor(max_workers=100) as executor:
    executor.map(lambda port: port_scanner(port, target) ,ports)
end = time.time(); print(f"[DBG]: Tiempo de ejecucion: {end - start}")
```
