@echo off

echo [101;93m ## Enumerando el sistema ########################################################[0m
echo.

echo [7m          Usuarios                                                          ^>[0m  
wmic useraccount get name,SID 2>nul | findstr "S-"
echo.
echo [7;31mListando Administradores:[0m
for /f "skip=6 delims=" %%a in ('net localgroup Administrators') do ( echo %%a | findstr /i /r /c:"^[^ ]" | findstr /v "comand") 
echo.
for /F %%i IN ('dir /b C:\Users') do (
    echo [7;31mUsuario: %%i[0m
    net user %%i 2>nul | findstr /I "nombre name memberships miembros"
    dir C:\Users\%%i 2>nul | findstr "M" | findstr /vI "documents desktop program appdata music favorites pictures games downloads contacts directory videos")
echo.

echo [7m          Usaurio actual: "%USERNAME%"                                      ^>[0m
echo [7;31mPrivilegios del usuario actual[0m
whoami /priv /fo list | findstr /I "nombre name"
echo.
echo [7;31mGrupos del usuario actual[0m
net user %username% | findstr /I "memberships miembros"
whoami /groups /fo list | findstr "Name"
echo.

echo [7m          Archivos                                                          ^>[0m  
echo [7;31mArchivos en la raiz del sistema[0m
dir C:\ /a:h /b | findstr /vI "recycle system volume information documents settings programdata recovery sys"
echo.
echo [7;31mAppdata[0m
dir /b %appdata% 2>nul
echo.
echo [7;31mDirectorio Home del usaurio actual[0m
dir /b /a %HOMEPATH% | findstr /vI "videos document desktop program appdata music favorites pres pictures games downloads ntuser contacts searches"
echo.

echo [7m          Servicios                                                      ^>[0m
echo [7;31mLista de servicios: [0m
wmic service where "startmode='Auto'" get name, pathname 2>nul
echo.
echo [7;31mServicios sin comillas?: [0m
wmic service where "startmode='Auto'" get name, pathname  2>nul | findstr /iv "Windows" | findstr /vi "name"
echo.

echo [7m          Redes                                                           ^>[0m
echo [7;31mDireciones IPv4[0m
ipconfig | findstr "IPv4"
echo.
echo [7;31mConexiones abiertas[0m
netstat -ano | findstr  "LISTENING" | findstr /v "\[::]"
echo. 

echo [7m          Registro de Windows                                                ^>[0m
echo [7;32mAlways Install elevated?[0m
reg query HKCU\SOFTWARE\Policies\Microsoft\Windows\Installer /v AlwaysInstallElevated 2> nul
reg query HKLM\SOFTWARE\Policies\Microsoft\Windows\Installer /v AlwaysInstallElevated 2> nul
echo.
echo [7;31mBackups del SAM y el SYSTEM:[0m 
IF EXIST %WINDIR%\repair\SAM ECHO.%WINDIR%\repair\SAM exists. 
IF EXIST %WINDIR%\System32\config\RegBack\SAM ECHO.%WINDIR%\System32\config\RegBack\SAM existe
IF EXIST %WINDIR%\System32\config\SAM ECHO.%WINDIR%\System32\config\SAM existe
IF EXIST %WINDIR%\repair\SYSTEM ECHO.%WINDIR%\repair\SYSTEM existe
IF EXIST %WINDIR%\System32\config\SYSTEM ECHO.%WINDIR%\System32\config\SYSTEM existe
IF EXIST %WINDIR%\System32\config\RegBack\SYSTEM ECHO.%WINDIR%\System32\config\RegBack\SYSTEM existe
echo.

echo [7m          Credenciales                                                ^>[0m
echo [7;31mLlaves GPP[0m 
for /d %%x in ("C:\ProgramData\Microsoft\Group Policy\History\*") do type "%%x\Machine\Preferences\Groups\Groups.xml" 2>nul
echo. 
echo [7;31mMozilla Passwords[0m 
for /d %%x in ("%appdata%\Mozilla\Firefox\Profiles\*") do (
    echo "%%x" 
    dir "%%x" | findstr "logins.json key4.db")
echo.
echo [7;31mCredenciales Autologon[0m 
reg.exe query "HKLM\software\microsoft\windows nt\currentversion\winlogon" 2>nul | findstr "DefaultPassword DefaultUserName"
echo.

echo [7m          Software Instalado                                                ^>[0m
wmic product get name
echo [7;31mProgramas de 32 bits[0m 
dir /b "C:\Program Files (x86)\" | findstr /vi "microsoft windows common"
echo.
echo [7;31mProgramas de 64 bits[0m 
dir /b "C:\Program Files\" | findstr /vi "microsoft windows common assemblies"
echo.
echo [7;31mInstalaciones[0m 
wmic product get name | findstr /v "Microsoft"
echo. 

echo [7mHistorial de comandos en Powershell:[0m
echo ----------------------------------------------------
type %userprofile%\AppData\Roaming\Microsoft\Windows\PowerShell\PSReadline\ConsoleHost_history.txt
echo.

echo [7mInformacion del sistema:[0m 
systeminfo 2>nul | findstr /i "stem host bios"
echo.

::echo [7mPosibles contraseÃ±as en archivos:[0m
::echo ----------------------------------
::findstr /si password *.xml *.ini *.txt *.config 2>nul 
::@timeout /t 7 > nul

::https://gist.githubusercontent.com/mlocati/fdabcaeb8071d5c75a2d51712db24011/raw/b710612d6320df7e146508094e84b92b34c77d48/win10colors.cmd
::dll hijacking?
::for %%A in ("%path:;=";"%") do ( cmd.exe /c icacls "%%~A" 2>nul | findstr /i "(F) (M) (W) :\" | findstr /i ":\\ everyone authenticated users todos %username%" && ECHO. )
::cmd /c ".\Documents\enumeracion_windows.bat"
















echo           Archivos                                                          ^>  
echo Archivos en la raiz del sistema
dir C:\ /b /a:h
echo.
echo Appdata
dir /b %appdata% 2>nul
echo.
echo Directorio Home del usaurio actual
dir /b /a %HOMEPATH% | findstr /vI "videos document desktop program appdata music favorites pres pictures games downloads ntuser contacts searches"
echo.

echo           Servicios                                                      ^>
echo Lista de servicios: 
wmic service where "startmode='Auto'" get name, pathname 2>nul
echo.
echo Servicios sin comillas?: 
wmic service where "startmode='Auto'" get name, pathname  2>nul | findstr /iv "Windows" | findstr /vi "name"echo.
echo.

echo           Redes                                                           ^>
echo Direciones IPv4
ipconfig | findstr "IPv4"
echo.
echo Conexiones abiertas
netstat -ano | findstr  "LISTENING" | findstr /v "\[::]"
echo. 

echo           Registro de Windows                                                ^>
echo Always Install elevated?
reg query HKCU\SOFTWARE\Policies\Microsoft\Windows\Installer /v AlwaysInstallElevated 2> nul
reg query HKLM\SOFTWARE\Policies\Microsoft\Windows\Installer /v AlwaysInstallElevated 2> nul
echo.
echo Backups del SAM y el SYSTEM: 
IF EXIST %WINDIR%\repair\SAM ECHO.%WINDIR%\repair\SAM exists. 
IF EXIST %WINDIR%\System32\config\RegBack\SAM ECHO.%WINDIR%\System32\config\RegBack\SAM existe
IF EXIST %WINDIR%\System32\config\SAM ECHO.%WINDIR%\System32\config\SAM existe
IF EXIST %WINDIR%\repair\SYSTEM ECHO.%WINDIR%\repair\SYSTEM existe
IF EXIST %WINDIR%\System32\config\SYSTEM ECHO.%WINDIR%\System32\config\SYSTEM existe
IF EXIST %WINDIR%\System32\config\RegBack\SYSTEM ECHO.%WINDIR%\System32\config\RegBack\SYSTEM existe
echo.

echo           Credenciales                                                ^>
echo Llaves GPP 
for /d %%x in ("C:\ProgramData\Microsoft\Group Policy\History\*") do type "%%x\Machine\Preferences\Groups\Groups.xml" 2> nul
echo. 
echo Mozilla Passwords 
for /d %%x in ("%appdata%\Mozilla\Firefox\Profiles\*") do (
    echo "%%x" 
    dir /b "%%x" | findstr "logins.json key4.db")
echo.
echo Credenciales Autologon 
reg.exe query "HKLM\software\microsoft\windows nt\currentversion\winlogon" 2>nul | findstr "DefaultPassword DefaultUserName"
echo.

echo           Software Instalado                                                ^>
wmic product get name 2>nul
echo Programas de 32 bits 
dir /b "C:\Program Files (x86)\" | findstr /vi "microsoft windows common"
echo.
echo Programas de 64 bits 
dir /b "C:\Program Files\" | findstr /vi "microsoft windows common assemblies"
echo.
echo Instalaciones 
wmic product get name 2>nul | findstr /v "Microsoft"
echo. 

echo Historial de comandos en Powershell:
type %userprofile%\AppData\Roaming\Microsoft\Windows\PowerShell\PSReadline\ConsoleHost_history.txt 2>nul
echo.

echo Informacion del sistema 
systeminfo 2>nul | findstr /i "stem host bios"
echo.

::echo Posibles contraseÃ±as en archivos:
::echo ----------------------------------
::findstr /si password *.xml *.ini *.txt *.config 2>nul 
::@timeout /t 7 > nul

::https://gist.githubusercontent.com/mlocati/fdabcaeb8071d5c75a2d51712db24011/raw/b710612d6320df7e146508094e84b92b34c77d48/win10colors.cmd
::dll hijacking?
::for %%A in ("%path:;=";"%") do ( cmd.exe /c icacls "%%~A" 2>nul | findstr /i "(F) (M) (W) :\" | findstr /i ":\\ everyone authenticated users todos %username%" && ECHO. )
::cmd /c ".\Documents\enumeracion_windows.bat"
echo. 

::https://gist.githubusercontent.com/mlocati/fdabcaeb8071d5c75a2d51712db24011/raw/b710612d6320df7e146508094e84b92b34c77d48/win10colors.cmd
